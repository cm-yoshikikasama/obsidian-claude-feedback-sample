---
allowed-tools: Bash(cd:*), Bash(date:*), Bash(TZ=:*), Bash(uv:*), Bash(find:*), Write, Read, Glob, Edit, LS
argument-hint: [YYYY-MM-DD]
description: 成果と明日の計画でデイリーノートを更新（オプション: 特定の日付）
---

# デイリーノート夜用アシスタント（更新）

## 日付の扱い

- date引数（$1）がYYYY-MM-DD形式で指定された場合、その日付を使用
- 引数が指定されない場合、今日の日付（JST）を使用
- 対象日付: ${TARGET_DATE}

## プロジェクト設定

```txt
PROJECT_A = "Aプロジェクト"
PROJECT_B = "Bプロジェクト"
PROJECT_C = "Cプロジェクト"
```

## 目標設定

```txt
GOAL_1 = "技術力の向上"
GOAL_2 = "プロジェクト管理能力の強化"
GOAL_3 = "コミュニケーション能力の向上"
```

## タスク

1. 引数から対象日付を決定、または今日の日付を使用
2. 対象日付のGoogle Calendarイベントを取得
3. 対象日付のデイリーノートを検索して読み込む
4. 成果と振り返りについて5つの質問をユーザーに一つずつ行う
5. 回答と自動生成された明日のタスクで既存のデイリーノートファイルを更新

### ステップ0: 対象日付の決定

```bash
TARGET_DATE="$1"
if [ -z "$TARGET_DATE" ]; then
  # 明示的にJSTタイムゾーンを使用
  TARGET_DATE=$(TZ=Asia/Tokyo date +%Y-%m-%d)
fi
echo "Processing daily note for: $TARGET_DATE"
```

### ステップ1: カレンダーイベントの取得

```bash
cd .claude && uv run today_cal/today-calendar.py --date "$TARGET_DATE"
```

カレンダー出力を解析して対象日付のイベントを理解し、関連する質問を生成する。

### ステップ2: 対象日付のデイリーノート検索

- 重要: 現在のディレクトリは`.claude/`なので、Globを使用する際は`path=".."`を指定する必要がある
- bashコマンド`find ../01_Daily -name "${TARGET_DATE}.md" -type f`を使用して対象のデイリーノートを検索
- または`Glob(path="..", pattern="01_Daily/**/[TARGET_DATE].md")`を使用
- ファイルは`01_Daily/YYYY/MM/[TARGET_DATE].md`形式である必要がある
- ファイルを読み込んで現在のコンテンツ構造を理解

### ステップ3: カレンダーコンテキストを使用したユーザーへの質問（AskUserQuestionツールを使用）

まず、Google Calendarのイベントを分析してプロジェクトに対応付ける。次にAskUserQuestionツールを使用してチェックボックス形式で質問を行う。

重要: 以下のすべての質問にAskUserQuestionツールを使用する。これにより、インタラクティブなチェックボックス・選択インターフェースが提供される。

ステータス番号: 1=未着手, 2=進行中, 3=レビュー中, 4=完了, 5=中止

#### 質問パターン（プロジェクトごと）

重要: 各プロジェクトについて、複数の質問（最大4つ）を含む単一のAskUserQuestion呼び出しを使用する。これにより、ユーザーが質問を切り替えられるタブ付きインターフェースが作成される。

各プロジェクト（PROJECT_A、PROJECT_B、PROJECT_C、ブログ・その他）について

1. 質問を行う前に、このプロジェクトのGoogle Calendarイベントを示すテキストメッセージを出力
2. デイリーノートからプロジェクト内のすべてのタスクを収集
3. 「未定」のタスクはスキップする - ステータスを尋ねない
4. タスクごとに1つの質問を作成（追加タスク質問のためのスペースを残すため最大3タスク）
5. 追加タスクについて尋ねる最後の質問を追加
6. すべてのタスクが「未定」の場合、追加タスクの質問のみを行う
7. すべての質問を1回のAskUserQuestion呼び出しで送信

まず、次のようなテキストメッセージを出力する

```text
## {PROJECT_NAME}のタスク進捗

Google Calendar予定
- [event 1]
- [event 2]
```

Then ask questions

タスクステータス質問フォーマット（プロジェクト内の各タスクについて）

```text
タスク「[タスク内容]」の状態を教えてください。
```

header: "タスク[N]" (e.g., "タスク1", "タスク2", etc.)

multiSelect: false

タスクステータスのオプション

- label: "未着手", description: "タスクにまだ着手していない"
- label: "進行中", description: "タスクを進行中"
- label: "レビュー中", description: "タスクがレビュー待ち"
- label: "完了", description: "タスクが完了"

中止したタスクについては、ユーザーは「Other」フィールドから入力できる。

追加タスク質問フォーマット（プロジェクトの最後の質問）

```text
{PROJECT_NAME}で追加でやったタスクがあれば「Other」で入力してください。なければ「なし」を選択してください。
```

header: "追加タスク"

multiSelect: false

オプション（最低2つ必要）

- label: "なし", description: "追加タスクはありません"
- label: "入力する", description: "Otherで追加タスクを入力します"

注: ユーザーは「Other」フィールドから追加タスクを入力できる。

例: PROJECT_Aに2つのタスクがある場合、タブとして表示される3つの質問（タスク1、タスク2、追加タスク）を含む1回のAskUserQuestion呼び出しを送信する。

#### 質問1: PROJECT_Aのタスク進捗

PROJECT_Aセクションの各タスクについてAskUserQuestionツールを使用

#### 質問2: PROJECT_Bのタスク進捗

PROJECT_Bセクションの各タスクについてAskUserQuestionツールを使用

#### 質問3: PROJECT_Cのタスク進捗

PROJECT_Cセクションの各タスクについてAskUserQuestionツールを使用

#### 質問4: ブログ・その他のタスク進捗

ブログとその他セクションの各タスクについてAskUserQuestionツールを使用

#### 質問5: 今日の振り返り（目標に沿った振り返り）

振り返りにはAskUserQuestionツールを使用しない。代わりに、振り返りを求めるテキストメッセージを出力する

```text
今日1日を設定した目標に沿って振り返ってください（該当する観点があれば教えてください）

- {GOAL_1}に関連する振り返り
- {GOAL_2}に関連する振り返り
- {GOAL_3}に関連する振り返り
```

ユーザーのテキスト回答を待つ。ユーザーは振り返りたい各カテゴリについて自由形式のテキスト回答を提供できる。

### ステップ4: デイリーノートファイルの更新

すべての回答を収集した後、デイリーノートファイルを更新する

1. `01_Daily/YYYY/MM/[TARGET_DATE].md`ファイルを読み込む
2. MTG・イベントセクションを更新
    - すべてのGoogle Calendarイベントを`- [x]`（参加）としてマーク
    - デイリーノートには存在するがGoogle Calendarにないイベントは打ち消し線でマーク: `- [ ] ~~イベント名~~ (実施せず)`
3. 今日のTodoセクションを更新
    - 完了した項目を`- [x]`としてマーク
    - 進行中の項目を`- [/]`として更新
    - レビュー中の項目を`- [R]`としてマーク
    - 中止した項目を`- [-]`としてマーク
    - 未着手の項目は`- [ ]`のまま保持
    - 進捗詳細を更新（例: 「実装進める」→「実装80%完了、動作検証に移行」）
4. 今日の振り返りセクションを更新
    - 感謝: ユーザーの回答を箇条書きで追加
    - Good: ユーザーの回答を箇条書きで追加
    - Motto: ユーザーの回答を追加
5. 明日やるセクションを更新
    - 「今日のTodo」セクションから完了していないタスク（状態が[x]でないもの）を自動抽出
    - 以下のステータスのタスクを含める: [ ] 未着手, [/] 進行中, [R] レビュー中
    - 以下のステータスのタスクを除外: [x] 完了, [-] 中止
    - これらのタスクを「明日やる」セクションにコピーし、すべてのチェックボックスを[ ]にリセット
    - プロジェクトに残りタスクがない場合、「[ ] 未定」に設定

すべてのステップを実行し、ただちにファイルを更新すること。

更新例

```markdown
## MTG・イベント

- [x] 08:30 - (プロジェクトA)実装 # Google Calendarにあった予定
- [x] 11:00 - (プロジェクトB)内部MTG # Google Calendarにあった予定
- [ ] ~~14:00 - (プロジェクトC)内部MTG~~ (実施せず) # Daily noteにあったがGoogle Calendarになかった予定
- [x] 終日 - 自宅 # Google Calendarにあった予定

## 今日のTodo

- Aプロジェクト
    - [x] 実装80%完了、動作検証に移行 # 完了
    - [/] APIテスト進行中 # 進行中
- Bプロジェクト
    - [x] 単体テスト完了、結合テスト開始 # 完了
    - [R] コードレビュー待ち # レビュー中
- Cプロジェクト
    - [x] アーキテクチャ検討完了、構成図作成中 # 完了
    - [-] 会議が中止になったため延期 # 中止
- ブログ
    - [ ] （予定なし） # 未着手
- その他
    - [ ] （予定なし）

## 今日の振り返り

### {GOAL_1}

- [ユーザーの回答内容]

### {GOAL_2}

- [ユーザーの回答内容]

### {GOAL_3}

- [ユーザーの回答内容]

## 明日やる

- {PROJECT_A}
    - [ ] [今日のTodoから未完了タスクを自動抽出]
- {PROJECT_B}
    - [ ] [今日のTodoから未完了タスクを自動抽出]
- {PROJECT_C}
    - [ ] [今日のTodoから未完了タスクを自動抽出]
- ブログ
    - [ ] [今日のTodoから未完了タスクを自動抽出]
- その他
    - [ ] [今日のTodoから未完了タスクを自動抽出]
```
